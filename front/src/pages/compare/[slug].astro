---
import BaseLayout from '../../layouts/BaseLayout.astro';
import providersData from '../../data/providers.json';
import pricingData from '../../data/pricing.json';
import { getFaviconUrl } from '../../lib/favicon';
import { getProxyTypeLabel, PROXY_TYPES } from '../../lib/proxy-types';
import { SITE_NAME, SITE_URL } from '../../lib/site';

interface Provider {
  id: string;
  name: string;
  slug: string;
  website_url: string;
  trial_offer: string | null;
  proxy_types: string[];
  cheapest_price_per_gb: number | null;
  has_pricing_data: boolean;
  pricing_count: number;
}

interface PricingTier {
  gb?: number;
  price_per_gb?: number;
  total?: number;
  pricing_model: string;
  ips?: number;
  price_per_ip?: number;
}

interface Pricing {
  provider_id: string;
  provider_name: string;
  proxy_type: string;
  price_url: string;
  tiers: PricingTier[];
  has_pricing: boolean;
  min_price_per_gb: number | null;
  max_price_per_gb: number | null;
  pricing_model: string;
  comparable: boolean;
  tier_count: number;
}

export async function getStaticPaths() {
  // Get providers with pricing data, sorted by cheapest price
  const providers = (providersData.providers as Provider[])
    .filter(p => p.cheapest_price_per_gb !== null)
    .sort((a, b) => (a.cheapest_price_per_gb ?? Infinity) - (b.cheapest_price_per_gb ?? Infinity))
    .slice(0, 20); // Limit to top 20 providers

  const comparisons: { params: { slug: string }; props: { provider1: Provider; provider2: Provider } }[] = [];

  for (let i = 0; i < providers.length; i++) {
    for (let j = i + 1; j < providers.length; j++) {
      // Sort alphabetically to ensure consistent URL format
      const [p1, p2] = [providers[i], providers[j]]
        .sort((a, b) => a.slug.localeCompare(b.slug));

      comparisons.push({
        params: { slug: `${p1.slug}-vs-${p2.slug}` },
        props: { provider1: p1, provider2: p2 }
      });
    }
  }

  return comparisons;
}

const { provider1, provider2 } = Astro.props;

// Get pricing data for each provider
const pricing1 = (pricingData.pricing as Pricing[]).filter(p => p.provider_id === provider1.id);
const pricing2 = (pricingData.pricing as Pricing[]).filter(p => p.provider_id === provider2.id);

// Get comparable pricing only
const comparablePricing1 = pricing1.filter(p => p.comparable);
const comparablePricing2 = pricing2.filter(p => p.comparable);

// Find common proxy types
const types1 = new Set(pricing1.map(p => p.proxy_type));
const types2 = new Set(pricing2.map(p => p.proxy_type));
const commonTypes = PROXY_TYPES.filter(t => types1.has(t) && types2.has(t));
const allTypes = [...new Set([...types1, ...types2])].filter(t => t !== 'other');

// Build comparison data by proxy type
interface ComparisonRow {
  proxyType: string;
  provider1Price: number | null;
  provider2Price: number | null;
  winner: 'provider1' | 'provider2' | 'tie' | 'none';
  provider1Range: string;
  provider2Range: string;
}

const comparisonData: ComparisonRow[] = allTypes.map(proxyType => {
  const p1 = pricing1.find(p => p.proxy_type === proxyType && p.comparable);
  const p2 = pricing2.find(p => p.proxy_type === proxyType && p.comparable);

  const price1 = p1?.min_price_per_gb ?? null;
  const price2 = p2?.min_price_per_gb ?? null;

  let winner: 'provider1' | 'provider2' | 'tie' | 'none' = 'none';
  if (price1 !== null && price2 !== null) {
    if (price1 < price2) winner = 'provider1';
    else if (price2 < price1) winner = 'provider2';
    else winner = 'tie';
  } else if (price1 !== null) {
    winner = 'provider1';
  } else if (price2 !== null) {
    winner = 'provider2';
  }

  const formatRange = (p: Pricing | undefined) => {
    if (!p || !p.comparable) return 'N/A';
    if (p.min_price_per_gb === null) return 'N/A';
    if (p.min_price_per_gb === p.max_price_per_gb) {
      return `$${p.min_price_per_gb.toFixed(2)}/GB`;
    }
    return `$${p.min_price_per_gb.toFixed(2)} - $${p.max_price_per_gb?.toFixed(2)}/GB`;
  };

  return {
    proxyType,
    provider1Price: price1,
    provider2Price: price2,
    winner,
    provider1Range: formatRange(p1),
    provider2Range: formatRange(p2),
  };
});

// Calculate overall winner
const provider1Wins = comparisonData.filter(d => d.winner === 'provider1').length;
const provider2Wins = comparisonData.filter(d => d.winner === 'provider2').length;
const overallWinner = provider1Wins > provider2Wins ? provider1
  : provider2Wins > provider1Wins ? provider2
  : null;

// SEO data
const pageTitle = `${provider1.name} vs ${provider2.name}: Proxy Pricing Compared`;
const pageDescription = `Compare ${provider1.name} and ${provider2.name} proxy pricing side-by-side. Starting prices: ${provider1.name} from $${provider1.cheapest_price_per_gb?.toFixed(2)}/GB, ${provider2.name} from $${provider2.cheapest_price_per_gb?.toFixed(2)}/GB. Updated ${pricingData.last_updated}.`;

const canonicalUrl = new URL(`/compare/${provider1.slug}-vs-${provider2.slug}/`, Astro.site).toString();

const breadcrumbs = [
  { name: SITE_NAME, url: SITE_URL },
  { name: 'Compare', url: `${SITE_URL}/compare` },
  { name: `${provider1.name} vs ${provider2.name}`, url: canonicalUrl },
];

// JSON-LD structured data
const comparisonSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebPage',
  'name': pageTitle,
  'description': pageDescription,
  'url': canonicalUrl,
  'mainEntity': {
    '@type': 'ItemList',
    'name': `${provider1.name} vs ${provider2.name} Comparison`,
    'itemListElement': [
      {
        '@type': 'ListItem',
        'position': 1,
        'item': {
          '@type': 'Product',
          'name': `${provider1.name} Proxy Services`,
          'url': `${SITE_URL}/provider/${provider1.slug}/`,
          'brand': { '@type': 'Brand', 'name': provider1.name },
          ...(provider1.cheapest_price_per_gb && {
            'offers': {
              '@type': 'Offer',
              'lowPrice': provider1.cheapest_price_per_gb,
              'priceCurrency': 'USD',
              'availability': 'https://schema.org/InStock',
            }
          }),
        }
      },
      {
        '@type': 'ListItem',
        'position': 2,
        'item': {
          '@type': 'Product',
          'name': `${provider2.name} Proxy Services`,
          'url': `${SITE_URL}/provider/${provider2.slug}/`,
          'brand': { '@type': 'Brand', 'name': provider2.name },
          ...(provider2.cheapest_price_per_gb && {
            'offers': {
              '@type': 'Offer',
              'lowPrice': provider2.cheapest_price_per_gb,
              'priceCurrency': 'USD',
              'availability': 'https://schema.org/InStock',
            }
          }),
        }
      }
    ]
  }
};

const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  'mainEntity': [
    {
      '@type': 'Question',
      'name': `Which is cheaper, ${provider1.name} or ${provider2.name}?`,
      'acceptedAnswer': {
        '@type': 'Answer',
        'text': overallWinner
          ? `${overallWinner.name} offers lower starting prices in more proxy categories, with pricing from $${overallWinner.cheapest_price_per_gb?.toFixed(2)}/GB.`
          : `Both providers have competitive pricing across different proxy types. Compare specific categories to find the best deal for your use case.`
      }
    },
    {
      '@type': 'Question',
      'name': `What proxy types do ${provider1.name} and ${provider2.name} both offer?`,
      'acceptedAnswer': {
        '@type': 'Answer',
        'text': commonTypes.length > 0
          ? `Both providers offer ${commonTypes.map(t => getProxyTypeLabel(t)).join(', ')} proxies.`
          : `These providers offer different proxy type portfolios. Check individual provider pages for details.`
      }
    },
    {
      '@type': 'Question',
      'name': 'How is pricing compared?',
      'acceptedAnswer': {
        '@type': 'Answer',
        'text': 'We compare the minimum $/GB rate for each proxy type. Only providers with per-GB pricing are directly comparable. Per-IP or per-proxy models are not converted.'
      }
    },
    {
      '@type': 'Question',
      'name': 'How often is pricing data updated?',
      'acceptedAnswer': {
        '@type': 'Answer',
        'text': `Pricing data was last updated ${pricingData.last_updated}. We regularly update pricing from official provider websites.`
      }
    }
  ]
};

// Get related comparisons (other providers compared with either of these two)
const allProviders = (providersData.providers as Provider[])
  .filter(p => p.cheapest_price_per_gb !== null && p.id !== provider1.id && p.id !== provider2.id)
  .sort((a, b) => (a.cheapest_price_per_gb ?? Infinity) - (b.cheapest_price_per_gb ?? Infinity))
  .slice(0, 6);

const relatedComparisons = allProviders.map(p => {
  const sorted = [provider1, p].sort((a, b) => a.slug.localeCompare(b.slug));
  return {
    slug: `${sorted[0].slug}-vs-${sorted[1].slug}`,
    title: `${provider1.name} vs ${p.name}`,
    provider: p,
  };
});

const formatPrice = (price: number | null) => {
  if (price === null) return 'N/A';
  return `$${price.toFixed(2)}`;
};
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  breadcrumbs={breadcrumbs}
  noindex={true}
>
  <script is:inline type="application/ld+json" set:html={JSON.stringify(comparisonSchema)} />
  <script is:inline type="application/ld+json" set:html={JSON.stringify(faqSchema)} />

  <div class="container compare-page">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <ol>
        <li><a href="/">Home</a></li>
        <li><a href="/providers">Providers</a></li>
        <li aria-current="page">{provider1.name} vs {provider2.name}</li>
      </ol>
    </nav>

    <header class="compare-header">
      <h1>{provider1.name} vs {provider2.name}</h1>
      <p class="subtitle">Side-by-side proxy pricing comparison</p>
    </header>

    <!-- Provider Cards -->
    <div class="provider-cards">
      <div class="provider-card {overallWinner?.id === provider1.id ? 'winner' : ''}">
        {overallWinner?.id === provider1.id && (
          <div class="winner-badge">Best Value</div>
        )}
        <div class="provider-card-header">
          <img
            src={getFaviconUrl(provider1.website_url, 48)}
            alt={`${provider1.name} favicon`}
            class="provider-favicon"
            width="48"
            height="48"
          />
          <div>
            <div class="provider-card-title">{provider1.name}</div>
            <a href={provider1.website_url} target="_blank" rel="noopener noreferrer" class="website-link">
              {provider1.website_url.replace('https://', '')}
            </a>
          </div>
        </div>
        <div class="provider-card-body">
          <div class="stat">
            <span class="stat-label">Starting Price</span>
            <span class="stat-value">{formatPrice(provider1.cheapest_price_per_gb)}/GB</span>
          </div>
          <div class="stat">
            <span class="stat-label">Proxy Types</span>
            <span class="stat-value">{provider1.proxy_types.filter(t => t !== 'other').length}</span>
          </div>
          <div class="stat">
            <span class="stat-label">Trial</span>
            <span class="stat-value">{provider1.trial_offer ? 'Yes' : 'No'}</span>
          </div>
          {provider1.trial_offer && (
            <div class="trial-info">{provider1.trial_offer}</div>
          )}
        </div>
        <div class="provider-card-footer">
          <a href={`/provider/${provider1.slug}`} class="btn btn-secondary">View Details</a>
          <a href={`/go/${provider1.slug}`} target="_blank" rel="sponsored noopener noreferrer" class="btn btn-primary">Visit Site</a>
        </div>
      </div>

      <div class="vs-divider">
        <span>VS</span>
      </div>

      <div class="provider-card {overallWinner?.id === provider2.id ? 'winner' : ''}">
        {overallWinner?.id === provider2.id && (
          <div class="winner-badge">Best Value</div>
        )}
        <div class="provider-card-header">
          <img
            src={getFaviconUrl(provider2.website_url, 48)}
            alt={`${provider2.name} favicon`}
            class="provider-favicon"
            width="48"
            height="48"
          />
          <div>
            <div class="provider-card-title">{provider2.name}</div>
            <a href={provider2.website_url} target="_blank" rel="noopener noreferrer" class="website-link">
              {provider2.website_url.replace('https://', '')}
            </a>
          </div>
        </div>
        <div class="provider-card-body">
          <div class="stat">
            <span class="stat-label">Starting Price</span>
            <span class="stat-value">{formatPrice(provider2.cheapest_price_per_gb)}/GB</span>
          </div>
          <div class="stat">
            <span class="stat-label">Proxy Types</span>
            <span class="stat-value">{provider2.proxy_types.filter(t => t !== 'other').length}</span>
          </div>
          <div class="stat">
            <span class="stat-label">Trial</span>
            <span class="stat-value">{provider2.trial_offer ? 'Yes' : 'No'}</span>
          </div>
          {provider2.trial_offer && (
            <div class="trial-info">{provider2.trial_offer}</div>
          )}
        </div>
        <div class="provider-card-footer">
          <a href={`/provider/${provider2.slug}`} class="btn btn-secondary">View Details</a>
          <a href={`/go/${provider2.slug}`} target="_blank" rel="sponsored noopener noreferrer" class="btn btn-primary">Visit Site</a>
        </div>
      </div>
    </div>

    <!-- Pricing Comparison Table -->
    <section class="comparison-section">
      <h2>Pricing Comparison by Proxy Type</h2>
      <p class="section-desc">
        Comparing minimum $/GB rates. Lower price wins. Only per-GB pricing is compared.
      </p>

      <div class="comparison-table-wrapper">
        <table class="comparison-table">
          <thead>
            <tr>
              <th>Proxy Type</th>
              <th>
                <img src={getFaviconUrl(provider1.website_url, 20)} alt="" width="20" height="20" />
                {provider1.name}
              </th>
              <th>
                <img src={getFaviconUrl(provider2.website_url, 20)} alt="" width="20" height="20" />
                {provider2.name}
              </th>
              <th>Winner</th>
            </tr>
          </thead>
          <tbody>
            {comparisonData.map(row => (
              <tr>
                <td class="type-cell">
                  <span class={`proxy-badge ${row.proxyType}`}>{getProxyTypeLabel(row.proxyType)}</span>
                </td>
                <td class={row.winner === 'provider1' ? 'winner-cell' : ''}>
                  {row.provider1Range}
                </td>
                <td class={row.winner === 'provider2' ? 'winner-cell' : ''}>
                  {row.provider2Range}
                </td>
                <td class="winner-indicator">
                  {row.winner === 'provider1' && (
                    <span class="winner-tag p1">{provider1.name}</span>
                  )}
                  {row.winner === 'provider2' && (
                    <span class="winner-tag p2">{provider2.name}</span>
                  )}
                  {row.winner === 'tie' && (
                    <span class="winner-tag tie">Tie</span>
                  )}
                  {row.winner === 'none' && (
                    <span class="winner-tag none">-</span>
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <div class="score-summary">
        <div class="score-card">
          <span class="score-provider">{provider1.name}</span>
          <span class="score-value">{provider1Wins} wins</span>
        </div>
        <div class="score-card">
          <span class="score-provider">{provider2.name}</span>
          <span class="score-value">{provider2Wins} wins</span>
        </div>
      </div>
    </section>

    <!-- Feature Comparison -->
    <section class="comparison-section">
      <h2>Feature Comparison</h2>

      <div class="feature-table-wrapper">
        <table class="feature-table">
          <thead>
            <tr>
              <th>Feature</th>
              <th>{provider1.name}</th>
              <th>{provider2.name}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Residential Proxies</td>
              <td class={provider1.proxy_types.includes('residential') ? 'has-feature' : 'no-feature'}>
                {provider1.proxy_types.includes('residential') ? 'Yes' : 'No'}
              </td>
              <td class={provider2.proxy_types.includes('residential') ? 'has-feature' : 'no-feature'}>
                {provider2.proxy_types.includes('residential') ? 'Yes' : 'No'}
              </td>
            </tr>
            <tr>
              <td>Datacenter Proxies</td>
              <td class={provider1.proxy_types.includes('datacenter') ? 'has-feature' : 'no-feature'}>
                {provider1.proxy_types.includes('datacenter') ? 'Yes' : 'No'}
              </td>
              <td class={provider2.proxy_types.includes('datacenter') ? 'has-feature' : 'no-feature'}>
                {provider2.proxy_types.includes('datacenter') ? 'Yes' : 'No'}
              </td>
            </tr>
            <tr>
              <td>Mobile Proxies</td>
              <td class={provider1.proxy_types.includes('mobile') ? 'has-feature' : 'no-feature'}>
                {provider1.proxy_types.includes('mobile') ? 'Yes' : 'No'}
              </td>
              <td class={provider2.proxy_types.includes('mobile') ? 'has-feature' : 'no-feature'}>
                {provider2.proxy_types.includes('mobile') ? 'Yes' : 'No'}
              </td>
            </tr>
            <tr>
              <td>ISP Proxies</td>
              <td class={provider1.proxy_types.includes('isp') ? 'has-feature' : 'no-feature'}>
                {provider1.proxy_types.includes('isp') ? 'Yes' : 'No'}
              </td>
              <td class={provider2.proxy_types.includes('isp') ? 'has-feature' : 'no-feature'}>
                {provider2.proxy_types.includes('isp') ? 'Yes' : 'No'}
              </td>
            </tr>
            <tr>
              <td>Free Trial</td>
              <td class={provider1.trial_offer ? 'has-feature' : 'no-feature'}>
                {provider1.trial_offer ? 'Yes' : 'No'}
              </td>
              <td class={provider2.trial_offer ? 'has-feature' : 'no-feature'}>
                {provider2.trial_offer ? 'Yes' : 'No'}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- FAQ Section -->
    <section class="faq-section">
      <h2>Frequently Asked Questions</h2>

      <div class="faq-list">
        <details>
          <summary>Which is cheaper, {provider1.name} or {provider2.name}?</summary>
          <p>
            {overallWinner
              ? `${overallWinner.name} offers lower starting prices in more proxy categories, with pricing from $${overallWinner.cheapest_price_per_gb?.toFixed(2)}/GB. However, the best choice depends on your specific proxy type needs.`
              : `Both providers have competitive pricing across different proxy types. The best choice depends on which proxy type you need.`
            }
          </p>
        </details>

        <details>
          <summary>What proxy types do both providers offer?</summary>
          <p>
            {commonTypes.length > 0
              ? `Both ${provider1.name} and ${provider2.name} offer ${commonTypes.map(t => getProxyTypeLabel(t)).join(', ')} proxies. Compare the pricing table above to see which offers better rates for each type.`
              : `These providers have different proxy type offerings. ${provider1.name} offers ${provider1.proxy_types.filter(t => t !== 'other').map(t => getProxyTypeLabel(t)).join(', ')}, while ${provider2.name} offers ${provider2.proxy_types.filter(t => t !== 'other').map(t => getProxyTypeLabel(t)).join(', ')}.`
            }
          </p>
        </details>

        <details>
          <summary>Do either offer a free trial?</summary>
          <p>
            {provider1.trial_offer && provider2.trial_offer
              ? `Both providers offer trials. ${provider1.name}: ${provider1.trial_offer}. ${provider2.name}: ${provider2.trial_offer}.`
              : provider1.trial_offer
                ? `${provider1.name} offers: ${provider1.trial_offer}. ${provider2.name} does not list a trial offer.`
                : provider2.trial_offer
                  ? `${provider2.name} offers: ${provider2.trial_offer}. ${provider1.name} does not list a trial offer.`
                  : `Neither provider currently lists a trial offer. Check their websites for current promotions.`
            }
          </p>
        </details>

        <details>
          <summary>How is pricing compared?</summary>
          <p>
            We compare the minimum $/GB rate for each proxy type. Only providers with per-GB pricing are directly comparable.
            Per-IP or per-proxy pricing models are not converted to $/GB as this would be misleading without knowing actual bandwidth usage.
          </p>
        </details>
      </div>
    </section>

    <!-- Related Comparisons -->
    <section class="related-section">
      <h2>Related Comparisons</h2>
      <p class="section-desc">Compare {provider1.name} with other providers</p>

      <div class="related-grid">
        {relatedComparisons.slice(0, 6).map(comp => (
          <a href={`/compare/${comp.slug}`} class="related-card">
            <div class="related-providers">
              <img src={getFaviconUrl(provider1.website_url, 24)} alt="" width="24" height="24" />
              <span class="vs-text">vs</span>
              <img src={getFaviconUrl(comp.provider.website_url, 24)} alt="" width="24" height="24" />
            </div>
            <span class="related-title">{comp.title}</span>
          </a>
        ))}
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .compare-page {
    padding: 2rem 0 4rem;
  }

  .breadcrumbs ol {
    list-style: none;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
    padding: 0;
    margin: 0 0 1.5rem;
    color: var(--color-text-light);
    font-size: 0.875rem;
  }

  .breadcrumbs li::after {
    content: '/';
    margin-left: 0.5rem;
    opacity: 0.6;
  }

  .breadcrumbs li:last-child::after {
    content: '';
    margin: 0;
  }

  .breadcrumbs a {
    color: var(--color-text-light);
  }

  .breadcrumbs a:hover {
    color: var(--color-primary);
  }

  .compare-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .compare-header h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }

  .subtitle {
    color: var(--color-text-light);
    font-size: 1.125rem;
  }

  /* Provider Cards */
  .provider-cards {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 1.5rem;
    align-items: stretch;
    margin-bottom: 3rem;
  }

  .provider-card {
    background: var(--color-bg);
    border: 2px solid var(--color-border);
    border-radius: 1rem;
    padding: 1.5rem;
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .provider-card.winner {
    border-color: var(--color-secondary);
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.15);
  }

  .winner-badge {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--color-secondary);
    color: white;
    padding: 0.25rem 1rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .provider-card-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--color-border);
  }

  .provider-favicon {
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .provider-card-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
    color: var(--color-text);
  }

  .website-link {
    color: var(--color-text-light);
    font-size: 0.875rem;
  }

  .provider-card-body {
    flex: 1;
  }

  .stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--color-border);
  }

  .stat:last-of-type {
    border-bottom: none;
  }

  .stat-label {
    color: var(--color-text-light);
    font-size: 0.875rem;
  }

  .stat-value {
    font-weight: 700;
  }

  .trial-info {
    margin-top: 0.75rem;
    padding: 0.75rem;
    background: var(--color-bg-alt);
    border-radius: 0.5rem;
    font-size: 0.875rem;
    color: var(--color-text-light);
  }

  .provider-card-footer {
    display: flex;
    gap: 0.75rem;
    margin-top: 1.5rem;
  }

  .btn {
    flex: 1;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    font-weight: 600;
    text-align: center;
    text-decoration: none;
    font-size: 0.875rem;
  }

  .btn-primary {
    background: var(--color-primary);
    color: white;
  }

  .btn-primary:hover {
    background: var(--color-primary-dark);
    text-decoration: none;
  }

  .btn-secondary {
    background: var(--color-bg-alt);
    color: var(--color-text);
    border: 1px solid var(--color-border);
  }

  .btn-secondary:hover {
    border-color: var(--color-primary);
    text-decoration: none;
  }

  .vs-divider {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .vs-divider span {
    background: var(--color-bg-alt);
    border: 2px solid var(--color-border);
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: var(--color-text-light);
  }

  /* Comparison Section */
  .comparison-section {
    margin-bottom: 3rem;
  }

  .comparison-section h2 {
    margin-bottom: 0.5rem;
  }

  .section-desc {
    color: var(--color-text-light);
    margin-bottom: 1.5rem;
  }

  .comparison-table-wrapper,
  .feature-table-wrapper {
    overflow-x: auto;
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    margin-bottom: 1.5rem;
  }

  .comparison-table,
  .feature-table {
    width: 100%;
    border-collapse: collapse;
  }

  .comparison-table th,
  .comparison-table td,
  .feature-table th,
  .feature-table td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid var(--color-border);
  }

  .comparison-table th,
  .feature-table th {
    background: var(--color-bg-alt);
    font-weight: 600;
    font-size: 0.875rem;
  }

  .comparison-table th img,
  .feature-table th img {
    vertical-align: middle;
    margin-right: 0.5rem;
    border-radius: 0.25rem;
  }

  .comparison-table tr:last-child td,
  .feature-table tr:last-child td {
    border-bottom: none;
  }

  .type-cell {
    font-weight: 600;
  }

  .proxy-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .proxy-badge.residential {
    background: #dbeafe;
    color: #1e40af;
  }

  .proxy-badge.datacenter {
    background: #e0e7ff;
    color: #4338ca;
  }

  .proxy-badge.mobile {
    background: #fce7f3;
    color: #9f1239;
  }

  .proxy-badge.isp {
    background: #d1fae5;
    color: #065f46;
  }

  @media (prefers-color-scheme: dark) {
    .proxy-badge.residential {
      background: #1e3a5f;
      color: #93c5fd;
    }

    .proxy-badge.datacenter {
      background: #312e81;
      color: #c7d2fe;
    }

    .proxy-badge.mobile {
      background: #831843;
      color: #fbcfe8;
    }

    .proxy-badge.isp {
      background: #064e3b;
      color: #a7f3d0;
    }
  }

  .winner-cell {
    background: rgba(16, 185, 129, 0.1);
    font-weight: 700;
  }

  .winner-indicator {
    text-align: center;
  }

  .winner-tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .winner-tag.p1 {
    background: var(--color-secondary);
    color: white;
  }

  .winner-tag.p2 {
    background: var(--color-primary);
    color: white;
  }

  .winner-tag.tie {
    background: var(--color-accent);
    color: white;
  }

  .winner-tag.none {
    background: var(--color-bg-alt);
    color: var(--color-text-light);
  }

  .score-summary {
    display: flex;
    gap: 1rem;
    justify-content: center;
  }

  .score-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem 2rem;
    background: var(--color-bg-alt);
    border-radius: 0.75rem;
    border: 1px solid var(--color-border);
  }

  .score-provider {
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  .score-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-primary);
  }

  /* Feature Table */
  .has-feature {
    color: var(--color-secondary);
    font-weight: 600;
  }

  .no-feature {
    color: var(--color-text-light);
  }

  /* FAQ Section */
  .faq-section {
    margin-bottom: 3rem;
  }

  .faq-section h2 {
    margin-bottom: 1.5rem;
  }

  .faq-list details {
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    padding: 1rem 1.25rem;
    background: var(--color-bg);
    margin-bottom: 0.75rem;
  }

  .faq-list summary {
    font-weight: 600;
    cursor: pointer;
    list-style: none;
  }

  .faq-list summary::-webkit-details-marker {
    display: none;
  }

  .faq-list summary::before {
    content: '+';
    display: inline-block;
    width: 1.5rem;
    font-weight: 700;
    color: var(--color-primary);
  }

  .faq-list details[open] summary::before {
    content: '-';
  }

  .faq-list p {
    margin-top: 1rem;
    color: var(--color-text-light);
    padding-left: 1.5rem;
  }

  /* Related Section */
  .related-section h2 {
    margin-bottom: 0.5rem;
  }

  .related-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-top: 1.5rem;
  }

  .related-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    padding: 1.25rem;
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    text-decoration: none;
    color: var(--color-text);
    transition: border-color 0.2s;
  }

  .related-card:hover {
    border-color: var(--color-primary);
    text-decoration: none;
  }

  .related-providers {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .related-providers img {
    border-radius: 0.25rem;
  }

  .vs-text {
    color: var(--color-text-light);
    font-size: 0.75rem;
    font-weight: 600;
  }

  .related-title {
    font-size: 0.875rem;
    font-weight: 600;
    text-align: center;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .compare-header h1 {
      font-size: 1.75rem;
    }

    .provider-cards {
      grid-template-columns: 1fr;
    }

    .vs-divider {
      padding: 1rem 0;
    }

    .related-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .score-summary {
      flex-direction: column;
    }

    .score-card {
      padding: 0.75rem 1.5rem;
    }
  }

  @media (max-width: 480px) {
    .related-grid {
      grid-template-columns: 1fr;
    }

    .provider-card-footer {
      flex-direction: column;
    }
  }
</style>
